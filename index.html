<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detecci√≥n de SO y Descarga en Segundo Plano</title>
  <script>
    function detectarSO() {
      let mensaje = "Sistema operativo no detectado";
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const esSafari = /^((?!chrome|android).)*safari/i.test(userAgent);

      if (userAgent.indexOf("Windows") !== -1) {
          mensaje = "üìå Est√°s usando Windows";
      } else if (userAgent.indexOf("Mac") !== -1) {
          mensaje = "üìå Est√°s usando macOS";
      } else if (userAgent.indexOf("Linux") !== -1) {
          mensaje = "üìå Est√°s usando Linux";
      }

      document.getElementById("mensaje").innerText = mensaje;

      // Inicia la descarga en segundo plano despu√©s de 1 segundo.
      setTimeout(() => descargarArchivo(esSafari), 1000);
    }

    function descargarArchivo(esSafari) {
      const url = "https://buhonero-tech.github.io/iatraincoop.txt";
      
      // Usamos fetch para obtener el archivo y convertirlo en Blob.
      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error("Error en la respuesta de red.");
          }
          return response.blob();
        })
        .then(blob => {
          // Creamos un objeto URL a partir del blob.
          const blobUrl = URL.createObjectURL(blob);

          if (esSafari) {
            // En Safari: abrir el blob en una nueva pesta√±a.
            window.open(blobUrl, '_blank');
            // Nota: En Safari es posible que el usuario deba confirmar o realizar la descarga manualmente.
          } else {
            // En otros navegadores: crear un enlace oculto y simular un clic.
            const enlace = document.createElement("a");
            enlace.style.display = "none";
            enlace.href = blobUrl;
            enlace.download = "iatraincoop.txt";
            document.body.appendChild(enlace);
            enlace.click();
            document.body.removeChild(enlace);
          }
          // Revocar el objeto URL despu√©s de un breve retraso para liberar memoria.
          setTimeout(() => URL.revokeObjectURL(blobUrl), 100);
        })
        .catch(error => {
          console.error("Error al descargar el archivo:", error);
        });
    }
  </script>
</head>
<body onload="detectarSO()">
  <h1>Detecci√≥n de Sistema Operativo</h1>
  <p id="mensaje">Detectando...</p>
  <p>La descarga del archivo <strong>iatraincoop.txt</strong> comenzar√° autom√°ticamente.</p>
</body>
</html>
